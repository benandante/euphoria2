<html>
<head>

<title>Title</title>

<link rel="stylesheet" href="css/jquery.mobile-1.3.2.min.css" />
<script src="js/jquery-1.9.1.min.js"></script>
<script src="js/jquery.mobile-1.3.2.min.js"></script>
<link rel="stylesheet" type="text/css" href="css/main.css" />
<script type="text/javascript" src="js/databaseModule.js"></script>
<script type="text/javascript" src="js/userActionTracker.js"></script>

</head>
<body >
	<div class="app">
		<div data-role="page" id="userInfoPage" data-theme="a">
			<!-- display/edit user info -->
			<script type="text/javascript">
					$(document).bind("pageload", function() {
						$("#selectAge").selectmenu('disable');
				    	$("#gender").selectmenu('disable');
				    	selectAgeHTML = '<select name="selectAge" id="selectAge" data-mini="true" data-theme="a">';
						for(i=5; i < 100; i++) {
							selectAgeHTML += '<option value="' +  i + '">' + i + '</option>';
						}
						selectAgeHTML += '</select>';
						 document.getElementById("selectAge").innerHTML = selectAgeHTML;
						$("#selectAge").trigger("create"); 
					 	$("#username").val(sessionStorage.getItem("currentUser"));
						$("#email").val(sessionStorage.getItem("currentUserEmail"));
						$("#address").val(sessionStorage.getItem("currentUserAddress"));
						$("#gender").val(sessionStorage.getItem("currentUserGender")).selectmenu('refresh');
						$("#selectAge").val(sessionStorage.getItem("currentUserAge")).selectmenu('refresh');  
				    	
					});	
				
			</script>
			<script>				
			
			if(newWasteNumber != 0) {
				$('#badge-page12').html(newWasteNumber).fadeIn();
			}
		
				function edit() {
					navigator.notification.alert("You can edit values to change your information");
					$("#email").removeAttr('readonly');
					$("#address").removeAttr('readonly');
					$("#selectAge").selectmenu('enable');
					$("#gender").selectmenu('enable');
				}
				
				function save() {
					 $.ajax({
					        type       : "GET",
					        url        : "http://localhost:9001/editUserData?",
					        crossDomain: false,
					        beforeSend : function() {$.mobile.loading('show')},
					        complete   : function() {$.mobile.loading('hide')},
					        dataType   : 'json',
					        data       : {
					        	token : sessionStorage.getItem("usertoken"),
					        	username :  $('#username').val(),  
					        	email:  $('#email').val(),  
					        	address:  $('#address').val(),  
					        	age:  $('#selectAge').val(),  
					        	gender:  $('#gender').val()
					        },
					        success    : function(data) {
					        	if (data.members.value != 'ok') {
					        		navigator.notification.alert(data.members.value);
									console.log("failure!");
					        	} else {
						        	sessionStorage.setItem("currentUserEmail", data.members.email);
						        	sessionStorage.setItem("currentUserAddress", data.members.address);
						        	sessionStorage.setItem("currentUserGender", data.members.gender);
						        	sessionStorage.setItem("currentUserAge", data.members.age);
					        		navigator.notification.alert("Changes are saved");
					        	}					        	
					        },
					        error      : function(e) {
					        	navigator.notification.alert("Internet connection is not available");
					        }
					    }); 
		    		
					 return false;
				}
				
			</script>
			<div data-role="header" data-position="fixed" data-id="nav">
				<h1>EUPHORIA</h1>
				<div data-role="navbar">
					<ul>
						<li><a href="foodList.html" id="shop" data-icon="custom"
							class="ui-badge-container"></a></li>
						<li><a href="foodUsage.html" id="list" data-icon="custom"
							class="ui-badge-container"></a></li>
						<li><a href="wastereason.html" id="bin" data-icon="custom"
							class="ui-badge-container"> <span id="badge-page12"
								class="badge"></span></a></li>
						<li><a href="survey.html" id="survey" data-icon="custom"
							class="ui-badge-container"></a></li>
							<li><a href="userInfo.html" id="userInfo2" data-icon="custom" class="ui-badge-container"></a></li>
					</ul>
				</div>
			</div>
			<!-- /navbar -->
			<div data-role="content">
				<form id="editUserForm">
					<div data-role="fieldcontain">
						<label for="username">Username:</label> <input type="text"
							name="username" id="username" value="" placeholder="Username" readonly="readonly"/>
					</div>
					<div data-role="fieldcontain">
						<label for="email">E-mail:</label> <input type="text" name="email"
							id="email" value="" placeholder="E-mail" readonly="readonly"/>
					</div>
					<div data-role="fieldcontain">
						<label for="address">Postal Code</label> <input type="text"
							name="address" id="address" value=""
							placeholder="Postal code without blanks" readonly="readonly"/>
					</div>
				 <div data-role="fieldcontain">
						<label for="age">Age</label>
           				<select name="selectAge" id="selectAge" data-mini="true" data-theme="a">
          
		  	 			</select>
					</div>
					<div data-role="fieldcontain" >
						 <label for="selectGender">Gender</label>
				           <select name="gender" id="gender"  data-mini="true" data-theme="a">
							   <option value="0">Gender</option>
							   <option value="1">Female</option>
							   <option value="2">Male</option>  
						   </select>
					</div> 
					<div class="ui-grid-b">
						<div class="ui-block-a">
							<a href="" data-role="button" data-mini="true" onclick="edit(); return false;">Edit</a>
						</div>
						<div class="ui-block-b">
							<a href="" data-role="button" data-mini="true" onclick="save(); return false;">Save</a>
						</div>
							<div class="ui-block-c">
							<a href="" data-role="button" data-mini="true" 
								onclick="window.location.href = 'login.html'; return false;">Logout</a>
						</div>

					</div>
				
				</form>
			</div>
		</div>
	</div>
	<script type="text/javascript" src="cordova.js"></script>
	 
</body>
</html>

